THEORY EvtBManip
  IMPORT THEORY PROJECTS
    /EB4EBCore THEORIES /EB4EBCore/EvtBStruc.dtf|org.eventb.theory.core.deployedTheoryRoot#EvtBStruc
  TYPE PARAMETERS EVENT,STATE
  OPERATORS
    (*\textbf{RelNextState}*) expression ($m:\mathit{Machine}(\mathit{STATE},\mathit{EVENT})$)
      well-definedness $\mathit{Event\_WellCons}(m)$
      direct definition 
        $\{ e,s\cdot((e=\mathit{Init}(m)\wedge s\in\mathit{AP}(m))\vee(e\in\mathit{Progress}(m)\wedge s\in\mathit{BAP}(m)[\{ e\}][\mathit{Inv}(m)\cap\mathit{Grd}(m)[\{ e\}]]))\mid e\mapsto s\}$
    (*\textbf{FunNextState}*) expression ($m:\mathit{Machine}(\mathit{STATE},\mathit{EVENT})$,$e:\mathit{EVENT}$)
      well-definedness $\mathit{Event\_WellCons}(m)$,$e\in\mathit{Event}(m)$
      direct definition 
        $\mathit{RelNextState}(m)[\{ e\}]$
  THEOREMS
    (*\textit{thm1}*): 
      $\forall e,m\cdot m\in\mathit{Machine}(\mathit{STATE},\mathit{EVENT})\wedge e\in\mathit{Event}(m)\wedge\mathit{Event\_WellCons}(m)\Rightarrow e\in\mathit{dom}(\mathit{RelNextState}(m))$
  PROOF RULES
    extension_def:
    Metavariables
      $m:\mathit{Machine}(\mathit{STATE},\mathit{EVENT})$
      $e:\mathit{EVENT}$
    Rewrite Rules
      (*\textit{rew1}*): $\mathit{FunNextState}(m,e)$
        rhs1: $e=\mathit{Init}(m)$ $\Rightarrow$ $\mathit{AP}(m)$
        rhs2: $e\in\mathit{Progress}(m)$ $\Rightarrow$ $\mathit{BAP}(m)[\{ e\}][\mathit{Inv}(m)\cap\mathit{Grd}(m)[\{ e\}]]$
END